<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript #<%= ticketId %></title>
    <style>
        :root{--bg-primary:#36393f;--bg-secondary:#2f3136;--text-normal:#dcddde;--text-muted:#72767d;--divider:#202225;--link:#00b0f4;--hover:rgba(4,4,5,0.07)}
        body{font-family:'Segoe UI',Helvetica,Arial,sans-serif;background-color:var(--bg-primary);color:var(--text-normal);margin:0;padding:0;overflow-x:hidden}
        .header{background-color:var(--bg-secondary);padding:15px 20px;border-bottom:1px solid var(--divider);box-shadow:0 1px 3px rgba(0,0,0,0.2);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
        .header-title{display:flex;align-items:center;gap:10px;font-weight:700;font-size:1.1rem;color:#fff}
        .closed-badge{background:#ed4245;color:white;padding:4px 8px;border-radius:4px;font-size:0.75rem;text-transform:uppercase;font-weight:bold}
        .chat-container{padding:20px;max-width:100%;display:flex;flex-direction:column;gap:0}
        .system-message-start{margin:20px auto;max-width:600px;text-align:center}
        .system-message-start h3{color:#fff;font-size:1.5rem;margin-bottom:5px}
        .system-message-start p{color:#b9bbbe;font-size:1rem}
        .message{display:flex;gap:16px;padding:8px 16px;margin-top:-1px}
        .message:hover{background-color:var(--hover)}
        .avatar{width:40px;height:40px;border-radius:50%;background-color:var(--bg-secondary);flex-shrink:0;background-size:cover;cursor:pointer}
        .message-content{display:flex;flex-direction:column;width:100%;overflow-wrap:break-word}
        .message-header{display:flex;align-items:center;gap:8px;margin-bottom:4px}
        .username{font-weight:500;font-size:1rem;color:#fff;cursor:pointer}
        .username:hover{text-decoration:underline}
        .bot-tag{background:#5865F2;color:white;font-size:0.625rem;padding:1px 4px;border-radius:3px;text-transform:uppercase;font-weight:500;line-height:1.3}
        .timestamp{font-size:0.75rem;color:var(--text-muted);margin-left:4px}
        .text{font-size:0.95rem;line-height:1.375rem;white-space:pre-wrap;color:var(--text-normal)}
        .text a{color:var(--link);text-decoration:none}
        .text a:hover{text-decoration:underline}
        .attachment{margin-top:8px;max-width:500px;border-radius:5px;overflow:hidden;background:var(--bg-secondary)}
        .attachment img{max-width:100%;max-height:400px;display:block;border-radius:4px}
        .footer-info{margin-top:50px;padding-top:20px;border-top:1px solid var(--divider);text-align:center;color:var(--text-muted);font-size:0.85rem;padding-bottom:40px}
    </style>
</head>
<body>
    <div class="header">
        <div class="header-title">
            <span>#</span>
            <%= ticketId.startsWith('ticket-') ? ticketId : 'ticket-' + ticketId %>
            <span class="closed-badge">Archived</span>
        </div>
        <div style="font-size:0.9rem;color:#b9bbbe">
            Closed on: <%= new Date(parseInt(closedAt)).toLocaleString('en-US') %>
        </div>
    </div>

    <div class="chat-container">
        <div class="system-message-start">
            <div style="background-color:#4f545c;width:60px;height:60px;border-radius:50%;margin:0 auto 15px auto;display:flex;align-items:center;justify-content:center">
                <span style="font-size:30px;color:white">#</span>
            </div>
            <h3>Welcome to the start of the ticket</h3>
            <p>This is the complete history of the conversation.</p>
        </div>

        <% if (messages && messages.length > 0) { %>
            <% messages.forEach(msg => { %>
                <div class="message">
                    <div class="avatar" style="background-image:url('<%= msg.avatar %>')" title="<%= msg.username %>"></div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="username" style="color:<%= msg.color %>">
                                <%= msg.username %>
                            </span>
                            
                            <% if(msg.bot) { %>
                                <span class="bot-tag">BOT</span>
                            <% } %>
                            
                            <span class="timestamp">
                                <%= new Date(msg.timestamp).toLocaleString('en-US') %>
                            </span>
                        </div>

                        <div class="text"><%= msg.content %></div>

                        <% if(msg.image) { %>
                            <div class="attachment">
                                <a href="<%= msg.image %>" target="_blank">
                                    <img src="<%= msg.image %>" alt="Attachment">
                                </a>
                            </div>
                        <% } %>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <p style="text-align:center;color:#72767d;margin-top:20px">No messages to display.</p>
        <% } %>
    </div>

    <div class="footer-info">
        End of transcript â€¢ Generated by <%= typeof bot !== 'undefined' ? bot.username : 'Rayus Moderation' %>
    </div>
</body>
</html>
